<%# Inline dispatch of the custom event. Attach CSP nonce when available. %>
<script<%= %( nonce="#{ERB::Util.html_escape(nonce)}") if nonce.present? %>>
  (function(){
    try {
      var payload = <%= raw(payload.to_json) %>;
      document.dispatchEvent(new CustomEvent('flash-unified:messages', { detail: payload }));
    } catch (e) {
      console.error('[FlashUnified] Failed to dispatch custom event', e);
    }
  })();
</script>
